---
import EditAgreements from "@/components/Process/agreements/EditAgreements.vue";
import ProcessLayout from "@/layouts/ProcessLayout.astro";
import RootLayout from "@/layouts/RootLayout.astro";
import MilitantService from "@/services/MilitantService";
import MinutesService from "@/services/Minutes";
import { getSession } from "auth-astro/server.ts";

const { id } = Astro.params;
const session = (await getSession(Astro.request)) as any;

if (!id) {
  throw new Error("No id provided");
}

async function getAgreements() {
  const services = new MinutesService();
  try {
    const agreements = await services.getAgreementsId(id!, session.jwt);
    return agreements;
  } catch (e) {
    console.error(e);
  }
}

async function getMilitants() {
  const service = new MilitantService();
  try {
    return service.getAll(session);
  } catch (e) {
    console.error(e);
  }
}

const militants = await getMilitants();
const agreement = await getAgreements();
---

<RootLayout>
  <ProcessLayout>
    <EditAgreements agreement={agreement} militants={militants} client:load />
  </ProcessLayout>
</RootLayout>
