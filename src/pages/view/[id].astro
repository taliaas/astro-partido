---
import ActaDisplay from "@/components/Acta/Ordinary/View/ActaDisplay.vue";
import MinutesService from "@/services/Minutes";
import { getSession } from "auth-astro/server";
import RootLayout from "../../layouts/RootLayout.astro";

const session: any = await getSession(Astro.request);
const { id } = Astro.params;

if (!id) {
  throw new Error("No id provided");
}

async function getActa() {
  const services = new MinutesService();
  try {
    return services.getMinute(id!, session.jwt);
  } catch (e) {
    console.error(e);
  }
}

async function getAbscents() {
  const service = new MinutesService();
  try {
    return service.getAbscents(id!, session.jwt);
  } catch (e) {
    console.error(e);
  }
}

const acta = await getActa();
const abscents = await getAbscents();
---

<RootLayout>
  <ActaDisplay client:load minute={acta} abscents={abscents} />
</RootLayout>
