---
import { getSession } from "auth-astro/server";
import ComputoService from "../../services/Computo";
import ComputoCore from "../../components/Indicators/ComputoCore.vue";
import RootLayout from "../../layouts/RootLayout.astro";

const session: any = await getSession(Astro.request);
const { id } = Astro.params;

const searchParams = Astro.url.searchParams;
const fecha = searchParams.get("fecha") || "";
const [year, month] = fecha.split("-");

async function getComputo() {
  const service = new ComputoService();
  try {
    return await service.getAllByCore(
      Number(year),
      Number(month),
      session?.jwt
    );
  } catch (e) {
    console.log(e);
  }
}

const computo = await getComputo();
---

<RootLayout>
  <ComputoCore computo={computo} client:load />
</RootLayout>
