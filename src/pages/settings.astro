---
import SettingsUser from "../components/settings/Settings.vue"
import RootLayout from "../layouts/RootLayout.astro";
import RoleService from "../services/RoleService";
import UserService from "../services/UserService";
import ClaimService from "../services/ClaimService";
import ComiteService from "../services/ComiteService";
import CoreService from "../services/CoreService";

const searchParams = Astro.url.searchParams
const page = Number(searchParams.get("page") ?? 1)

async function getAllUsers() {
    const service = new UserService()
    try {
        return service.getAllUser(page)
    } catch (e) {
        console.error(e)
    }
}
async function getAllRoles() {
    const service = new RoleService()
    try {
        return service.getRoles()
    } catch (e) {
        console.error(e)
    }
}

async function getClaims(){
    const service = new ClaimService()
    try {
        return service.getAllClaims()
    } catch (e) {
        console.error(e)
    }
}

async function getComites(){
    const service = new ComiteService()
    try {
        return service.getAllComite()
    } catch (e) {
        console.error(e)
    }
}

async function nucleos(){
    const service = new CoreService()
    try {
        return service.getAllCore()
    } catch (e) {
        console.error(e)
    }
}

const roles = await getAllRoles()
const users = await getAllUsers()
const claims = await getClaims()
const cores = await nucleos()
const comites = await getComites()
---

<RootLayout>
    <SettingsUser roles={roles} users={users} claims={claims} cores={cores} comites={comites} client:load/>
</RootLayout>
