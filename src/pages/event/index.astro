---
import EventsManage from "@/components/Event/EventsManage.vue";
import RootLayout from "../../layouts/RootLayout.astro";
import EventService from "../../services/EventService";
import { getSession } from "auth-astro/server";
import UserService from "@/services/UserService";

const session = (await getSession(Astro.request)) as any;
const searchParams = Astro.url.searchParams;
const page = Number(searchParams.get("page")) || 1;
const limit = Number(searchParams.get("limit")) || 10;

async function getAllEvent(page: any) {
  const service = new EventService();
  try {
    return await service.getAllEvents(page, limit, session.jwt);
  } catch (e) {
    console.error(e);
  }
}
const getAllUsers = async () => {
  const service = new UserService();
  try {
    return await service.getUserList(session.jwt);
  } catch (error) {
    console.error("Error fetching users:", error);
  }
};

const users = await getAllUsers();
const events = await getAllEvent(page);
---

<RootLayout>
  <EventsManage
    events={events}
    page={page}
    limit={limit}
    users={users}
    client:load
  />
</RootLayout>
