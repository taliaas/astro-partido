---
import { getSession } from "auth-astro/server";
import DashboardHome from "@/components/Dashboard/DashboardHome.vue";
import RootLayout from "@/layouts/RootLayout.astro";
import MinutesService from "@/services/Minutes";
const session = (await getSession(Astro.request)) as any;

async function getLatestMinute() {
  const service = new MinutesService();
  try {
    return service.getLatestMinute(session.jwt);
  } catch (e) {
    console.error(e);
  }
}

async function typeDocuments() {
  const service = new MinutesService();
  try {
    return await service.getMinutes(session.jwt);
  } catch (e) {
    console.error(e);
  }
}

const [documents, list] = await Promise.all([
  getLatestMinute(),
  typeDocuments(),
]);

const cards = [
  {
    title: "Total Documentos Pendientes",
    value: list?.pending ?? 0,
    icon: "FolderClock",
    description: "Acumulado total",
  },
  {
    title: "Total Documentos Procesados",
    value: list?.proccesing ?? 0,
    icon: "FolderCheck",
    description: "Acumulado total",
  },
  {
    title: "Total de Documentos",
    value: list?.documents ?? 0,
    icon: "Folders",
    description: "Acumulado total",
  },
  {
    title: "Pendientes Este Mes",
    value: list?.monthlyPending ?? 0,
    icon: "FileClock",
    description: "Mes actual",
  },
  {
    title: "Procesados Este Mes",
    value: list?.monthlyProcessing ?? 0,
    icon: "FileCheck2",
    description: "Mes actual",
  },
  {
    title: "Documentos Este Mes",
    value: list?.monthlyDocuments ?? 0,
    icon: "Files",
    description: "Mes actual",
  },
];
---

<RootLayout>
  <DashboardHome documents={documents!} cards={cards} client:load />
</RootLayout>
