---
import MinutesOrdinary from "@/components/Acta/Ordinary/Create/MinutesOrdinary.vue";
import RootLayout from "@/layouts/RootLayout.astro";
import MilitantService from "@/services/MilitantService";
import MinutesService from "@/services/Minutes";
import { getSession } from "auth-astro/server";

const session = await getSession(Astro.request);
const n_user = session?.user;

let data;
if (Astro.request.method === "POST") {
  const formdata = await Astro.request.formData();
  data = JSON.stringify(formdata.get("data"));
}

async function getMilitantes() {
  const service = new MilitantService();
  try {
    const ro = await service.getMilitantes((session as any).jwt);
    console.log(ro);

    return ro;
  } catch (e) {
    console.error(e);
  }
}
async function getAgreements() {
  const service = new MinutesService();
  try {
    return await service.getAgreements((session as any).jwt);
  } catch (e) {
    console.error(e);
  }
}
const agreements = await getAgreements();
const militantes = await getMilitantes();
---

<RootLayout>
  <MinutesOrdinary
    agreements={agreements}
    militantes={militantes}
    client:load
  />
</RootLayout>
