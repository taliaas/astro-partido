---
import CoreService from "../../services/CoreService";
import OrdinaryService from "../../services/OrdinaryService";
import RootLayout from "../../layouts/RootLayout.astro";
import { getSession } from "auth-astro/server";
import MilitantService from "@/services/MilitantService";
import Edit from "@/components/Acta/Ordinary/Edit/Edit.vue";

const { id } = Astro.params;
const session = (await getSession(Astro.request)) as any;

if (!id) {
  throw new Error("No id provided");
}

async function getActa() {
  const services = new OrdinaryService();
  try {
    const acta = services.getMinute(id!, session.jwt);
    return acta;
  } catch (e) {
    console.error(e);
  }
}
async function getCore() {
  const service = new CoreService();
  try {
    return await service.getAllCore(session.jwt);
  } catch (e) {
    console.error(e);
  }
}
async function getMilitantes() {
  const service = new MilitantService();
  try {
    return await service.getMilitantes((session as any).jwt);
  } catch (e) {
    console.error(e);
  }
}
const militantes = await getMilitantes();
const cores = await getCore();
const acta = await getActa();
console.log("Acta", acta);
---

<RootLayout>
  <Edit acta={acta} cores={cores} militantes={militantes} client:load />
</RootLayout>
