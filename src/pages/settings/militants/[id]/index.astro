---
import MilitantView from "@/components/settings/militantes/MilitantView.vue";
import RootLayout from "@/layouts/RootLayout.astro";
import MilitantService from "@/services/MilitantService";
import { getSession } from "auth-astro/server";

const { id } = Astro.params;
const session = (await getSession(Astro.request)) as any;

if (!id) {
  throw new Error("No id provided");
}

async function getMilitants() {
  const services = new MilitantService();
  try {
    return await services.findMilitant(id!, (session as any).jwt);
  } catch (e) {
    console.error(e);
  }
}

const militant = await getMilitants();
---

<RootLayout>
  <MilitantView militant={militant} client:load />
</RootLayout>
