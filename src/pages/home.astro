---
import {getSession} from "auth-astro/server";
import DashboardHome from "@/components/Dashboard/DashboardHome.vue";
import RootLayout from "../layouts/RootLayout.astro";
import MinutesService from "../services/Minutes";
const session = (await getSession(Astro.request)) as any;

async function getLatestMinute() {
  const service = new MinutesService();
  try {
    return service.getLatestMinute(session.jwt);
  } catch (e) {
    console.error(e);
  }
}

async function typeDocuments() {
  const service = new MinutesService();
  try {
    return await service.getMinutes(session.jwt);
  } catch (e) {
    console.error(e);
  }
}

const [documents, list] = await Promise.all([
  getLatestMinute(),
  typeDocuments(),
]);

const cards = [
  {
    title: "Documentos Pendientes",
    value: list?.pending ?? 0,
    icon: "FileText",
  },
  {
    title: "Documentos Procesados",
    value: list?.proccesing ?? 0,
    icon: "FileCheck2",
  },
  {
    title: "Total de Documentos",
    value: list?.documents ?? 0,
    icon: "Files",
  },
];
---

<RootLayout>
  <DashboardHome
    documents={documents!}
    cards={cards} client:load
  />
</RootLayout>
