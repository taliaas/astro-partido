---
import { getSession } from "auth-astro/server";
import NotificationService from "@/services/NotificationServices";
import NotificationContainer from "@/components/Otros/NotificationUser.vue";
import RootLayout from "@/layouts/RootLayout.astro";

const session = (await getSession(Astro.request)) as any;
const searchParams = Astro.url.searchParams;
const page = searchParams.get("page") || 1;
const limit = searchParams.get("limit") || 10;

async function getNotification() {
  const service = new NotificationService();
  try {
    return await service.getAll(Number(page), Number(limit), session?.jwt);
  } catch (e) {
    console.error("Error fetching notification:", e);
    throw e;
  }
}
const notifications = await getNotification();
---

<RootLayout>
  <NotificationContainer
    notifications={notifications}
    limit={Number(limit)}
    page={Number(page)}
    client:load
  />
</RootLayout>
